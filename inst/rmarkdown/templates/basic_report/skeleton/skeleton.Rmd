---
title: "`r params$report_title`"
author: "`r params$report_author`"
logo: "`r params$logo_path`"
output: output_format
params:
  data: NULL
  report_title: NULL
  report_author: NULL
  logo_path: NULL
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

\begin{minipage}[t]{0.5\textwidth}
```{r actual, eval=TRUE, echo=FALSE, out.width = '95%'}
data <- params$data
revs <- get_revisions(data, interval=1)

latest_pub_date <- max(data$pub_date)
latest_obs_date <- max(data$time)
data_last2 <- data %>% 
  dplyr::filter(
    pub_date == latest_pub_date ,
    time <= latest_obs_date & time >= (latest_obs_date - 4*365)
    )
data_last2_revs <- revs %>% 
  dplyr::filter(
    pub_date == latest_pub_date ,
    time <= latest_obs_date & time >= (latest_obs_date - 4*365)
    )

p <- plot_vintages(data_last2, type = "line", title = "Current series and revisions" )  
p <-  suppressMessages(plot_vintages(data_last2_revs, type = "bar", p = p) + theme_reviser(legend.position = "none") )
p
```
\end{minipage}
\begin{minipage}[t]{0.5\textwidth}
```{r revisions1, eval=TRUE, echo=FALSE, out.width = '95%'}
revs <- get_revisions(data, interval=1)

latest_pub_date <- max(revs$pub_date)
latest_obs_date <- max(revs$time)
data_last2 <- revs %>% 
  dplyr::filter(
    pub_date <= latest_pub_date & pub_date >= (latest_pub_date - 2*365),
    time <= latest_obs_date & time >= (latest_obs_date - 4*365)
    )

plot_vintages(data_last2, type = "line", title = "Revisions of the past 2 years")
```
\end{minipage}
\begin{minipage}[t]{0.5\textwidth}
```{r last2years, eval=TRUE, echo=FALSE, out.width = '95%'}
latest_pub_date <- max(data$pub_date)
latest_obs_date <- max(data$time)
data_last2 <- data %>% 
  dplyr::filter(
    pub_date <= latest_pub_date & pub_date >= (latest_pub_date - 2*365),
    time <= latest_obs_date & time >= (latest_obs_date - 4*365)
    )

plot_vintages(data_last2, type = "line", title = "Releases of the past 2 years" ) + theme_reviser(legend.position = "none")
```
\end{minipage}
\begin{minipage}[t]{0.5\textwidth}
```{r revisions, eval=TRUE, echo=FALSE, out.width = '95%'}
revs <- get_revisions(data, interval=1)

latest_pub_date <- max(revs$pub_date)
latest_obs_date <- max(revs$time)
data_last2 <- revs %>% 
  dplyr::filter(
    pub_date <= latest_pub_date & pub_date >= (latest_pub_date - 2*365),
    time <= latest_obs_date & time >= (latest_obs_date - 4*365)
    )

plot_vintages(data_last2, type = "line", title = "Revisions of the past 2 years")
```
\end{minipage}



```{r example, eval=TRUE, include=FALSE}
revs <- get_revisions(data, interval=1)


gdp_long <- vintages_long(gdp_wide, keep_na = FALSE)

plot_vintages(
  gdp_long %>% 
  filter(
    pub_date >= as.Date("2009-01-01") & pub_date < as.Date("2010-01-01"),
    time < as.Date("2010-01-01") & time > as.Date("2008-01-01")
    ),
  type = "line",
  title = "Revisions of GDP during the financial crisis",
  subtitle = "qoq growth rates")
  
final_release <- get_nth_release(gdp_long, n = 16)

df <- get_nth_release(gdp_long, n = 0:6)

summary <- get_revision_analysis(df, final_release)
print(summary)

efficient_release <- get_first_efficient_release(df, final_release)
```

